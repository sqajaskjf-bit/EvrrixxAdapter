<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Evrrixx — profile</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous"/>
</head>
<body>
  <!-- Aurora glow (hidden until reveal) -->
  <div id="aurora" class="aurora" aria-hidden="true"></div>

  <!-- Snow canvas -->
  <canvas id="snow" aria-hidden="true"></canvas>

  <!-- Top controls: device toggle + views -->
  <div class="top-right" aria-hidden="false">
    <div class="device-toggle" role="tablist" aria-label="Display mode">
      <button id="btn-pc" class="device-btn" title="PC view" aria-pressed="false" aria-label="Desktop view"><i class="fa-solid fa-desktop"></i></button>
      <button id="btn-phone" class="device-btn" title="Mobile view" aria-pressed="false" aria-label="Mobile view"><i class="fa-solid fa-mobile-screen-button"></i></button>
    </div>
    <div id="view-count" class="view-count" aria-live="polite">👁️ <span id="views">0</span></div>
  </div>

  <!-- Overlay - first interaction -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" tabindex="0">
    <div class="overlay-inner">
      <div id="overlayText" class="overlay-text">Click to continue</div>
      <div class="overlay-sub">Tap anywhere to reveal profile and start music</div>
    </div>
  </div>

  <!-- Main wrapper (hidden until reveal) -->
  <main id="wrap" class="wrap hidden" role="main" aria-label="Profile card">
    <article id="card" class="card" aria-live="polite">
      <!-- LEFT column (avatar / meta / socials) -->
      <aside class="left" id="leftCol">
        <div class="avatar-wrap" aria-hidden="false">
          <img id="avatar" class="avatar" src="https://avatars.mds.yandex.net/i?id=37e394a9871b342e37f3dca00c22c825e9bf71b8-5886795-images-thumbs&n=13" alt="Evrrixx avatar">
        </div>

        <div class="info-block">
          <div class="nick" id="nickSmall">Evrrixx</div>
          <div class="meta">OSU player</div>
          <div class="geo"><a class="geo-link" href="https://www.google.com/maps/place/Lviv" target="_blank" rel="noopener">📍 Lviv</a></div>
        </div>

        <div class="socials" id="socials">
          <a class="social-btn" href="https://discord.com/users/1379041675070148670" target="_blank" title="Discord" rel="noopener"><i class="fa-brands fa-discord"></i></a>
          <a class="social-btn" href="https://t.me/Evrrixx" target="_blank" title="Telegram" rel="noopener"><i class="fa-brands fa-telegram"></i></a>
          <a class="social-btn" href="https://www.tiktok.com/@svalipchik" target="_blank" title="TikTok" rel="noopener"><i class="fa-brands fa-tiktok"></i></a>
          <a class="social-btn" href="https://osu.ppy.sh/users/38462434" target="_blank" title="Osu" rel="noopener"><i class="fa-solid fa-circle"></i></a>
        </div>
      </aside>

      <!-- RIGHT: main info + player -->
      <section class="right" id="rightCol">
        <header class="header-row">
          <div class="nick-large" id="nickLarge">Evrrixx</div>
          <div class="osu-stats">🌍 <span class="stat-val">#1.1kk</span> &nbsp;|&nbsp; 🇺🇦 <span class="stat-val">#22k</span></div>
        </header>

        <p class="bio">OSU player</p>

        <!-- Player area -->
        <div class="player" id="player">
          <img id="cover" class="cover" src="https://images.genius.com/58bde3f707f18fb105b26ee786f24bad.1000x1000x1.png" alt="track cover">
          <div class="player-body">
            <div class="track-info">
              <div class="track-title">baby cute — универ</div>
              <div class="track-sub">track</div>
            </div>

            <div id="progressWrap" class="progress-wrap" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" tabindex="0">
              <div id="progressBar" class="progress-bar"></div>
            </div>

            <div class="controls-row">
              <button id="playBtn" class="playbtn" aria-label="Play/pause">
                <i id="playIcon" class="fa-solid fa-play"></i>
                <i id="pauseIcon" class="fa-solid fa-pause" style="display:none"></i>
              </button>

              <div class="time" id="time" aria-live="polite">00:00 / 00:00</div>

              <div class="volume">
                <button id="muteBtn" class="mute" aria-label="Mute"><i class="fa-solid fa-volume-high"></i></button>
                <input id="volume" class="volume-slider" type="range" min="0" max="1" step="0.01" value="0.8" aria-label="Volume">
              </div>
            </div>
          </div>
        </div>

      </section>
    </article>
  </main>

  <!-- AUDIO element -->
  <audio id="audio" preload="metadata" crossorigin="anonymous">
    <source src="https://sefon.pro/api/mp3_download/direct/1362072/3vUCAL9SUTYUJlpqN96WmNiAVCIkVxwbfrpr1nc34l9vjo7WZbWMezr6WL9BMVq0tHqmbpdsiBmSi1pqocPzFN58ejf8EBJJwkPbEh3iQhHt9sLRFfef4pIcMNiie8U2AI0x7_Ei0ub0xroANdPEMrWr0xjdHUfGSpnN8EoQ/" type="audio/mpeg">
  </audio>

<script>
/* ---------------------------
   DOM refs
   --------------------------- */
const overlay = document.getElementById('overlay');
const wrap = document.getElementById('wrap');
const aurora = document.getElementById('aurora');
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const playIcon = document.getElementById('playIcon');
const pauseIcon = document.getElementById('pauseIcon');
const progressBar = document.getElementById('progressBar');
const progressWrap = document.getElementById('progressWrap');
const timeEl = document.getElementById('time');
const volumeSlider = document.getElementById('volume');
const muteBtn = document.getElementById('muteBtn');
const cover = document.getElementById('cover');
const viewEl = document.getElementById('views');
const viewCountBox = document.getElementById('view-count');
const btnPc = document.getElementById('btn-pc');
const btnPhone = document.getElementById('btn-phone');

let isPlaying = false;

/* ---------------------------
   Views counter (CountAPI with fallback)
   --------------------------- */
(function hitViews(){
  fetch('https://api.countapi.xyz/hit/evrrixx-bio/views')
    .then(r=>r.json())
    .then(d=>{
      const v = d && d.value ? d.value : 1;
      viewEl.textContent = Number(v).toLocaleString();
      viewCountBox.classList.add('visible');
    })
    .catch(err=>{
      console.warn('CountAPI error', err);
      try{
        let v = parseInt(localStorage.getItem('views_evrrixx')||'0',10);
        v = v+1;
        localStorage.setItem('views_evrrixx', String(v));
        viewEl.textContent = v.toLocaleString();
      }catch(e){
        viewEl.textContent = '1';
      }
    });
})();

/* ---------------------------
   Reveal sequence & aurora fade
   --------------------------- */
function revealSequence(){
  aurora.classList.add('visible');          // fade in aurora
  wrap.classList.remove('hidden');          // show wrapper
  // add reveal class to card for staggered children animations
  document.getElementById('card').classList.add('reveal');
}

/* ---------------------------
   Play attempt inside pointerdown -> must be direct user gesture
   Starts from the beginning as requested
   --------------------------- */
function tryPlayDirectly(){
  try {
    audio.currentTime = 0; // start from beginning
  } catch(e) { /* ignore if not allowed */ }

  const p = audio.play();
  if(p && p.then){
    p.then(()=> {
      isPlaying = true;
      playIcon.style.display = 'none';
      pauseIcon.style.display = '';
      cover.classList.add('playing');
    }).catch(err=>{
      console.warn('Play blocked by browser:', err);
    });
  } else {
    // older browsers
    isPlaying = !audio.paused;
    if(isPlaying){ playIcon.style.display='none'; pauseIcon.style.display=''; cover.classList.add('playing'); }
  }
}

/* overlay pointerdown: immediate reveal + play */
overlay.addEventListener('pointerdown', function onPointer(e){
  // remove overlay immediately (instant UX)
  overlay.removeEventListener('pointerdown', onPointer);
  overlay.classList.add('fade-out');
  setTimeout(()=> overlay.remove(), 320);
  revealSequence();
  // Synchronously inside gesture try to play from start
  tryPlayDirectly();
});

/* also keyboard accessibility */
overlay.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' || e.key === ' ') {
    overlay.dispatchEvent(new PointerEvent('pointerdown'));
  }
});

/* ---------------------------
   Play / Pause button behaviour
   --------------------------- */
playBtn.addEventListener('click', ()=>{
  if(audio.paused){
    audio.play().then(()=> {
      isPlaying = true;
      playIcon.style.display = 'none';
      pauseIcon.style.display = '';
      cover.classList.add('playing');
    }).catch(err=> {
      console.warn('Play blocked:', err);
    });
  } else {
    audio.pause();
    isPlaying = false;
    playIcon.style.display = '';
    pauseIcon.style.display = 'none';
    cover.classList.remove('playing');
  }
});

/* ---------------------------
   Volume & Mute
   --------------------------- */
muteBtn.addEventListener('click', ()=>{
  audio.muted = !audio.muted;
  muteBtn.innerHTML = audio.muted ? '<i class="fa-solid fa-volume-xmark"></i>' : '<i class="fa-solid fa-volume-high"></i>';
});
volumeSlider.addEventListener('input', (e)=>{
  audio.volume = parseFloat(e.target.value);
  if(audio.volume > 0 && audio.muted){
    audio.muted = false;
    muteBtn.innerHTML = '<i class="fa-solid fa-volume-high"></i>';
  }
});

/* ---------------------------
   Progress & time updates
   --------------------------- */
audio.addEventListener('loadedmetadata', ()=>{
  timeEl.textContent = `00:00 / ${formatTime(audio.duration)}`;
});
audio.addEventListener('timeupdate', ()=>{
  const cur = audio.currentTime || 0;
  const dur = audio.duration || 0;
  progressBar.style.width = dur ? (cur/dur*100)+'%' : '0%';
  timeEl.textContent = `${formatTime(cur)} / ${formatTime(dur)}`;
  progressWrap.setAttribute('aria-valuenow', Math.floor(cur));
});
progressWrap.addEventListener('click', (e)=>{
  const rect = progressWrap.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const p = Math.max(0, Math.min(1, x / rect.width));
  if(audio.duration) audio.currentTime = p * audio.duration;
});
function formatTime(t){
  if(!isFinite(t) || t <= 0) return '00:00';
  const m = Math.floor(t/60), s = Math.floor(t%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

/* ---------------------------
   Autopause when tab hidden
   --------------------------- */
document.addEventListener('visibilitychange', ()=>{
  if(document.hidden && !audio.paused){
    audio.pause();
    isPlaying = false;
    playIcon.style.display = '';
    pauseIcon.style.display = 'none';
    cover.classList.remove('playing');
  }
});

/* ---------------------------
   Device toggle (pc / phone) + persistence
   --------------------------- */
const deviceStateKey = 'evr_device_v2';
const deviceBtns = document.querySelectorAll('.device-btn');
function applyDevice(device){
  if(device === 'phone') document.body.classList.add('device-phone');
  else document.body.classList.remove('device-phone');
  // style active button
  const pcBtn = document.getElementById('btn-pc');
  const phoneBtn = document.getElementById('btn-phone');
  if(pcBtn) pcBtn.classList.toggle('active', device === 'pc');
  if(phoneBtn) phoneBtn.classList.toggle('active', device === 'phone');
  localStorage.setItem(deviceStateKey, device);
}
document.getElementById('btn-pc').addEventListener('click', ()=> applyDevice('pc'));
document.getElementById('btn-phone').addEventListener('click', ()=> applyDevice('phone'));
// init device
const savedDevice = localStorage.getItem(deviceStateKey) || (window.innerWidth <= 480 ? 'phone' : 'pc');
applyDevice(savedDevice);

/* ---------------------------
   Snow canvas (lightweight)
   --------------------------- */
(function snow(){
  const canvas = document.getElementById('snow');
  const ctx = canvas.getContext('2d');
  let W = canvas.width = innerWidth;
  let H = canvas.height = innerHeight;
  window.addEventListener('resize', ()=>{ W = canvas.width = innerWidth; H = canvas.height = innerHeight; });

  const flakes = Array.from({length: 120}, ()=>({ x: Math.random()*W, y: Math.random()*H, r: 1+Math.random()*3, s: 0.5+Math.random()*1.7 }));
  let t = 0;
  function frame(){
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = 'rgba(255,255,255,0.85)';
    ctx.beginPath();
    for(const f of flakes){
      ctx.moveTo(f.x,f.y);
      ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
    }
    ctx.fill();
    // update
    t += 0.01;
    for(const f of flakes){
      f.y += f.s + Math.sin(t + f.x*0.01)*0.3;
      f.x += Math.cos(t*0.5 + f.y*0.005)*0.4;
      if(f.y > H+10){ f.y = -10; f.x = Math.random()*W; }
    }
    requestAnimationFrame(frame);
  }
  frame();
})();

/* ---------------------------
   Accessibility: allow Enter on overlay
   --------------------------- */
document.addEventListener('DOMContentLoaded', ()=>{
  overlay.addEventListener('keydown', e => {
    if(e.key === 'Enter' || e.key === ' ') overlay.dispatchEvent(new PointerEvent('pointerdown'));
  });
});
</script>
</body>
</html>
